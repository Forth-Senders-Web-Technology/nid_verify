<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">

<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	
	<title>PDF417 - 2D Barcode generator test</title>
	       
	<script src="bcmath-min.js" type="text/javascript"></script>
    <script src="pdf417-min.js" type="text/javascript"></script>
    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js" integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj" crossorigin="anonymous"></script>
	<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ho+j7jyWK8fNQe+A12Hb8AhRq26LrZ/JpcUGGOn+Y7RsweNrtN/tE3MoK7ZeZDyx" crossorigin="anonymous"></script>

    <script>  

        window.onload = function() { 

            var hub3_code = "<pin>3706317876</pin><name> HUW MIA </name><DOB>12 Jul 1987</DOB><FP></FP><F>Right Index</F><TYPE>A</TYPE><V>2.0</V><ds>302c0214733766837d7afc3514acc6b182cde5a8a8225dba02143ca6d1a777859b362102c2cda54407834ee0c7f2</ds>";   

            var textToEncode = document.getElementById("textToEncode");
            textToEncode.value = hub3_code;   

        	PDF417.init(hub3_code);           	

            var barcode = PDF417.getBarcodeArray();

            // block sizes (width and height) in pixels
            var bw = 2.32;
            var bh = 0.29;

            // create canvas element based on number of columns and rows in barcode
            var canvas = document.createElement('canvas');
            canvas.width = bw * barcode['num_cols'];
            canvas.height = bh * barcode['num_rows'];
            document.getElementById('barcode').appendChild(canvas);

            var ctx = canvas.getContext('2d');                    

            // graph barcode elements
            var y = 0;
            // for each row
            for (var r = 0; r < barcode['num_rows']; ++r) {
                var x = 0;
                // for each column
                for (var c = 0; c < barcode['num_cols']; ++c) {
                    if (barcode['bcode'][r][c] == 1) {                        
                        ctx.fillRect(x, y, bw, bh);
                    }
                    x += bw;
                }
                y += bh;
            }            
        }

        function generate() {
            var textToEncode = document.getElementById("textToEncode");

            document.getElementById("download_btn_div").style.display = "none"; 

            PDF417.init(textToEncode.value);  
            document.getElementById('data_assign_with_tag').innerHTML = textToEncode.value;     

            var barcode = PDF417.getBarcodeArray();

            // block sizes (width and height) in pixels
            var bw = 2;
            var bh = 2;

            // width="232px" height="29px"

            // create canvas element based on number of columns and rows in barcode
            var container = document.getElementById('barcode');
            container.removeChild(container.firstChild);

            var canvas = document.createElement('canvas');
            canvas.width = bw * barcode['num_cols'];
            canvas.height = bh * barcode['num_rows'];
            container.appendChild(canvas);

            var ctx = canvas.getContext('2d');


            // graph barcode elements
            var y = 0;
            // for each row
            for (var r = 0; r < barcode['num_rows']; ++r) {
                var x = 0;
                // for each column
                for (var c = 0; c < barcode['num_cols']; ++c) {
                    if (barcode['bcode'][r][c] == 1) {                        
                        ctx.fillRect(x, y, bw, bh);
                    }
                    x += bw;
                }
                y += bh;
            }       
        }
    
    </script>

</head>
<body>
	<div class="container">
		<div class="row">
			<div class="col-md-6 mx-auto">
								
				<p>Text to encode</p>
				<textarea id="textToEncode" style="width: 100%; height: 200px;"></textarea>
				<p class="text-center ">
					<button class="btn btn-lg btn-outline-danger mt-3 generate_btn" onclick="generate()">Generate</button>
				</p>
				<p>PDF417 2D barcode in canvas</p>
				<div id="barcode"></div>

				<br><br>

				<div class="alert alert-danger">
					ডাউনলোড বাটনে ক্লিক করার আগে অবশ্যই PNG বাটনে ক্লিক করবেন
				</div>
				<div class="text-center">
					<div id="setImageInAncor" style="width: 100px;" class="btn btn-primary set_anchor">PNG</div>
					<div style="display: none;" id="download_btn_div" class="download_btn_div">
						<a href="#" id="btn_click" class="btn btn-danger mt-3">Download</a>
					</div>
				</div>
				    <br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br>

			</div>

				<div style="display: none;" id="data_assign_with_tag"></div>
		</div>
	</div>

<script type="text/javascript">
    var setImageInAncor = document.getElementById('setImageInAncor');
    var ButtonClick = document.getElementById('btn_click');
    setImageInAncor.addEventListener('click', function () {
    	document.getElementById("download_btn_div").style.display = "block"; 


    	var per_name_temp = document.getElementById("data_assign_with_tag").children;
    	var per_name = document.getElementsByTagName("name")[0].innerHTML;
    	console.log(per_name);



    const canvas = document.querySelector('canvas');
    const context = canvas.getContext('2d');
    const anchor = document.querySelector('a');
    const rand = i=>Math.random()*i<<0
    const fileName = `barcode_${per_name}.png`;

    drawOntoCanvas();
    anchor.addEventListener('click', onClickAnchor);

	    function onClickAnchor(e) {
	      if (window.navigator.msSaveBlob) {
	        window.navigator.msSaveBlob(canvas.msToBlob(), fileName);
	        e.preventDefault();
	      } else {
	        anchor.setAttribute('download', fileName);
	        anchor.setAttribute('href', canvas.toDataURL());
	      }
	    }

	    function drawOntoCanvas(){
	      const size = 100;
	      context.fillStyle = 'rgba(0,0,0,0)';
	      let i = 10;
	      while (i--) {
	        context.fillRect(rand(size),rand(size),rand(size),rand(size));
	      }
	    }
    });
</script>
</body>

</html>



